<!DOCTYPE html>
<html lang="en-GB">
    <head>
        <meta charset="utf-8" />
        <style>
            body {
                background: #fafafa;
            }

            .products {
                display: flex;
                flex-direction: column;
            }
        </style>
        <!-- Import the script from the CDN. Remember to use type="module" -->
        <script type="module" src="https://unpkg.com/pay-trail-e2@0.0.5/PayTrail.js"></script>
    </head>
    <body>
        <!-- Initialize the component with the same parameters you would use for the input names. Omit adding products
            into the component, as those are added programmatically -->
        <pay-trail
            MERCHANT_ID="13466"
            URL_SUCCESS="http://www.example.com/success"
            URL_CANCEL="http://www.example.com/cancel"
            PARAMS_IN="MERCHANT_ID,URL_SUCCESS,URL_CANCEL,ORDER_NUMBER,PARAMS_IN,PARAMS_OUT,PAYER_PERSON_PHONE,PAYER_PERSON_EMAIL,PAYER_PERSON_FIRSTNAME,PAYER_PERSON_LASTNAME,PAYER_COMPANY_NAME,PAYER_PERSON_ADDR_STREET,PAYER_PERSON_ADDR_POSTAL_CODE,PAYER_PERSON_ADDR_TOWN,PAYER_PERSON_ADDR_COUNTRY,AMOUNT"
            PARAMS_OUT="ORDER_NUMBER,PAYMENT_ID,AMOUNT,CURRENCY,PAYMENT_METHOD,TIMESTAMP,STATUS"
            PAYER_PERSON_PHONE="01234567890"
            PAYER_PERSON_EMAIL="john.doe@example.com"
            PAYER_PERSON_FIRSTNAME="John"
            PAYER_PERSON_LASTNAME="Doe"
            PAYER_COMPANY_NAME="Test Company"
            PAYER_PERSON_ADDR_STREET="Test Street 1"
            PAYER_PERSON_ADDR_POSTAL_CODE="608009"
            PAYER_PERSON_ADDR_TOWN="Test Town"
            PAYER_PERSON_ADDR_COUNTRY="AA"
            submit_button_label="Pay here"
        ></pay-trail>

        <button id="add-product" onclick="addProduct()">Add product</button>
        <button id="remove-product" onclick="removeProduct()">Remove product</button>

        <div class="products"></div>

        <script>
            const product = {
                item_id: 0,
                item_title: 'Product name',
                item_unit_price: '29.99',
                item_vat_percent: '24.00',
            };
            // You can select the paytrail component and use it's API by selecting it with querySelector
            const paytrailField = document.querySelector('pay-trail');
            const productsField = document.querySelector('.products');

            const addProductToList = (prods) => {
                const productRow = document.createElement('p');
                productRow.innerText = 'Product ' + prods.length;
                productsField.appendChild(productRow);
            };

            const removeProductFromList = (prods) => {
                prods[prods.length - 1].remove();
                paytrailField.calculateAuthCodeString();
            };

            const addProduct = () => {
                // getProducts returns an array of products added to PayTrail
                const prods = paytrailField.getProducts();
                const productCopy = { ...product };

                productCopy.item_title = 'Product name ' + prods.length;
                productCopy.item_id = prods.length;

                // AddProducts takes a single product or an array of products.
                paytrailField.addProducts(productCopy);
                // If you don't calculate your authcode in the backend, you can generate the AUTHCODE in the
                // corresponding field by using the following function
                paytrailField.calculateAuthCodeString();
                addProductToList(prods);
            };

            const removeProduct = () => {
                const prods = Array.from(productsField.querySelectorAll('p'));

                // You can easily remove a product by index with the removeProductAtIndex()
                paytrailField.removeProductAtIndex(prods.length - 1);
                removeProductFromList(prods);
            };
        </script>
    </body>
</html>
